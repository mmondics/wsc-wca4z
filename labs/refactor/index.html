
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://mmondics.github.io/wsc-wca4z/labs/refactor/">
      
      
        <link rel="prev" href="../understand/">
      
      
        <link rel="next" href="../transform/">
      
      
      <link rel="icon" href="../../images/wca4z-logo.svg">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.17">
    
    
      
        <title>Refactor Phase - watsonx Code Assistant for Z Workshop</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bcfcd587.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings1.css">
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings2.css">
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings3.css">
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings4.css">
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings5.css">
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings6.css">
    
      <link rel="stylesheet" href="../../css/print-site.css">
    
      <link rel="stylesheet" href="../../css/print-site-material.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#refactor-phase" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="watsonx Code Assistant for Z Workshop" class="md-header__button md-logo" aria-label="watsonx Code Assistant for Z Workshop" data-md-component="logo">
      
  <img src="../../images/wca4z-logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            watsonx Code Assistant for Z Workshop
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Refactor Phase
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_2">
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/mmondics/wsc-wca4z/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="watsonx Code Assistant for Z Workshop" class="md-nav__button md-logo" aria-label="watsonx Code Assistant for Z Workshop" data-md-component="logo">
      
  <img src="../../images/wca4z-logo.svg" alt="logo">

    </a>
    watsonx Code Assistant for Z Workshop
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mmondics/wsc-wca4z/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Presentations
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Presentations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../presentations/watsonx%20Code%20Assistant%20for%20Z%20Overview%20-%20WSC%20Workshop%20July%209%202024.pdf" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Presentation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop-architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab Architecture
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lab-assignments/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab Assignments
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Lab Documentation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Lab Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../understand/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Understand Phase
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Refactor Phase
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Refactor Phase
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview-of-the-refactor-phase" class="md-nav__link">
    <span class="md-ellipsis">
      Overview of the Refactor phase
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#start-the-refactoring-assistant" class="md-nav__link">
    <span class="md-ellipsis">
      Start the Refactoring Assistant
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#refactor-your-cobol-programs-using-refactoring-assistant" class="md-nav__link">
    <span class="md-ellipsis">
      Refactor your COBOL Programs using Refactoring Assistant
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modify-the-refactored-service-code" class="md-nav__link">
    <span class="md-ellipsis">
      Modify the refactored service code
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../transform/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transform Phase
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../validate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Validate Phase
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../print_page/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Print Site
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview-of-the-refactor-phase" class="md-nav__link">
    <span class="md-ellipsis">
      Overview of the Refactor phase
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#start-the-refactoring-assistant" class="md-nav__link">
    <span class="md-ellipsis">
      Start the Refactoring Assistant
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#refactor-your-cobol-programs-using-refactoring-assistant" class="md-nav__link">
    <span class="md-ellipsis">
      Refactor your COBOL Programs using Refactoring Assistant
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modify-the-refactored-service-code" class="md-nav__link">
    <span class="md-ellipsis">
      Modify the refactored service code
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="refactor-phase">Refactor Phase<a class="headerlink" href="#refactor-phase" title="Permanent link">&para;</a></h1>
<h2 id="overview-of-the-refactor-phase">Overview of the Refactor phase<a class="headerlink" href="#overview-of-the-refactor-phase" title="Permanent link">&para;</a></h2>
<p>In the <em>Refactor</em> phase, the COBOL application developer uses the <em>Refactoring Assistant</em> VS Code extension to extract parts of the COBOL application into a modular business service.  In the typical workflow the application architect has identified the functionality to refactor and has communicated this to the COBOL application developer.   In this lab the functionality within the <em>GenApp</em> application that calculates a customer's average motor vehicle insurance policy premiums has been selected.</p>
<h2 id="start-the-refactoring-assistant">Start the Refactoring Assistant<a class="headerlink" href="#start-the-refactoring-assistant" title="Permanent link">&para;</a></h2>
<p><em>Refactoring Assistant</em> is delivered as an Open Container Initiative (OCI) image that runs as a container in a Linux Virtual Machine (VM).  Your lab environment provides this Linux VM but you need to start the Refactoring Assistant within the VM by following the instructions in this section.</p>
<ol>
<li>
<p>Open <em>PuTTY</em> from the taskbar by clicking on the icon highlighted in the screen snippet below:</p>
<p><img alt="zva-desktop-putty" src="../../images/zva-desktop-putty.png" /></p>
</li>
<li>
<p>In the list of PuTTY's <em>Saved Sessions</em>, select <em>wca4z-ra</em> and click <em>Open</em>.</p>
<p><img alt="putty-open" src="../../images/putty-open.png" /></p>
</li>
<li>
<p>After clicking <em>Open</em>, you will receive a security warning. Select <em>Accept</em>.</p>
<p><img alt="putty-security" src="../../images/putty-security.png" /></p>
<p>This warning should only appear the first time you load the <em>wca4z-ra</em> session.</p>
<p>Scripts will automatically run in the PuTTY session to configure and start the Refactoring Assistant.  In addition, a GitLab server will be started that will be used later in the <em>Transform</em> phase.  </p>
</li>
<li>
<p>Once you receive the message <code>IBM watsonx Code Assistant for Z Refactoring Assistant started</code> in the PuTTY console, you can close PuTTY.</p>
<p><img alt="putty-ra-started" src="../../images/putty-ra-started.png" /></p>
</li>
</ol>
<h2 id="refactor-your-cobol-programs-using-refactoring-assistant">Refactor your COBOL Programs using Refactoring Assistant<a class="headerlink" href="#refactor-your-cobol-programs-using-refactoring-assistant" title="Permanent link">&para;</a></h2>
<p>The <em>Refactor</em> phase and the remaining phases in the lab (<em>Transform</em> and <em>Validate</em>) use VS Code.</p>
<ol>
<li>
<p>Before you start VS Code, let's get an API key that you will need to enter within VS Code that will grant you access to the <em>watsonx Code Assistant for Z</em> service that runs in IBM Cloud. In your lab environment that API Key is stored in a file on the Windows Desktop.  Open the text file named <em>wca4z-key.txt</em> on the Windows Desktop. </p>
<p><img alt="zva-desktop-apikey" src="../../images/zva-desktop-apikey.png" /></p>
</li>
<li>
<p>Select the entire API key in the text file and use <em>Ctrl-C</em> to copy it to the clipboard.</p>
<p><img alt="notepad-apikey" src="../../images/notepad-apikey.png" /></p>
</li>
<li>
<p>Open <em>Visual Studio Code</em> (VS Code) by double-clicking its desktop shortcut.</p>
<p><img alt="zva-desktop-vscode" src="../../images/zva-desktop-vscode.png" /></p>
</li>
<li>
<p>At the bottom Explorer pane on the left, expand the <em>IBM WATSONX CODE ASSISTANT FOR Z</em> section if it is not already expanded.</p>
<p>You should see a prompt to <em>Enter API key</em>.</p>
<p><img alt="vscode-apikey" src="../../images/vscode-apikey.png" /></p>
</li>
<li>
<p>Click the <em>Enter API key</em> prompt. An input bar will appear in the top-middle of the page. Use <em>Ctrl-V</em> to paste the API key that you just copied from the text file and press <em>Enter</em>.</p>
<p><img alt="vscode-apikey-prompt" src="../../images/vscode-apikey-prompt.png" /></p>
<p>If this was successful, the <em>Enter API key</em> prompt should disappear and you should see a message popup in the lower right that says <em>Connected to watsonx Code Assistant for Z</em>.</p>
</li>
<li>
<p>Click the user icon in the bottom-left corner of VS Code, and select the option to <em>Sign in with IBM ADDI to use IBM watsonx Code Assistant for Z Refactoring Assistant (1)</em>.</p>
<p><img alt="vscode-addi-login" src="../../images/vscode-addi-login.png" /></p>
<p>A new tab will open in VS Code with a login prompt.</p>
</li>
<li>
<p>Log in with the following credentials:</p>
<ul>
<li>Email address: <code>dev@wca4z-ra.ibm.com</code></li>
<li>Password: <code>password</code></li>
</ul>
<p><img alt="vscode-addi-login" src="../../images/vscode-addi-login.png" /></p>
<p>After logging in, a new input field will appear in the top-middle of VS Code to select a project.</p>
<p><img alt="vscode-genapp-project" src="../../images/vscode-genapp-project.png" /></p>
</li>
<li>
<p>Select the <em>GenApp</em> option in this new field.</p>
<p>Another new page will open with an option to search for artifacts within the GenApp project. </p>
</li>
<li>
<p>Click the search bar, click the dropdown that currently says <em>All artifact types</em>, and select <em>Programs</em>.</p>
<p><img alt="vscode-ra-artifact-types" src="../../images/vscode-ra-artifact-types.png" /></p>
</li>
<li>
<p>From the list of Programs, select <em>GETAAVG</em> and press enter.</p>
<p><img alt="vscode-ra-getaavg" src="../../images/vscode-ra-getaavg.png" /></p>
<p>A graph showing the dependencies for the <em>GETAAVG</em> program will appear.</p>
<p><img alt="vscode-ra-getaavg-graph" src="../../images/vscode-ra-getaavg-graph.png" /></p>
</li>
<li>
<p>Click the <em>GETAAVG</em> program to get a new panel with the program's details, and incoming and outgoing references.</p>
<p><img alt="vscode-ra-graph-getaavg" src="../../images/vscode-ra-graph-getaavg.png" /></p>
</li>
<li>
<p>Click on the 3 dots associated with the <em>GETAAVG</em> program and select the <em>Identify conditional statements</em> option.</p>
<p><img alt="vscode-ra-identify-conditional-statements" src="../../images/vscode-ra-identify-conditional-statements.png" /></p>
<p>This will open the COBOL code for the <em>GETAAVG</em> program in VS Code and it will list all of the conditional statements in the code in the bottom left <em>Key Conditions</em> section.</p>
<p><img alt="vscode-getaavg" src="../../images/vscode-getaavg.png" /></p>
</li>
<li>
<p>Select the <em>WHEN '0AVMOT'</em> statement under <em>KEY CONDITIONS</em> to jump to the conditional statement in the <em>GETAAVG</em> program code. This is the condition that, when true, calls the functionality that we wish to refactor.</p>
<p><img alt="vscode-getaavg-0AVMOT" src="../../images/vscode-getaavg-0AVMOT.png" /></p>
</li>
<li>
<p>In the <em>KEY CONDITIONS</em> section, right-click the <em>WHEN '0AVMOT'</em> statement and select the option <em>Slice on condition to new service</em>.</p>
<p><img alt="vscode-getaavg-0AVMOT-slice" src="../../images/vscode-getaavg-0AVMOT-slice.png" /></p>
</li>
<li>
<p>A new input field will appear in the top middle of VS Code with a prompt to <em>Enter service name</em>.</p>
</li>
<li>
<p>Provide a service name of <code>refactor</code> and press enter.</p>
<p><strong>Important</strong>: This environment is configured such that you must provide the name <code>refactor</code> in this step, exactly as shown.  The reason for this is that a Jenkins pipeline that is triggered when you do a Git commit later expects to find artifacts in a folder of the name <code>refactor</code>, and what you enter in this step will be the name of the folder in which these artifacts are stored.</p>
<p><img alt="vscode-getaavg-0AVMOT-slice-refactor" src="../../images/vscode-getaavg-0AVMOT-slice-refactor.png" /></p>
</li>
<li>
<p>The code will be sliced into new service named <em>refactor</em> and will open in a new tab on right side of VS Code.</p>
<p><img alt="vscode-getaavg-0AVMOT-slice-refactor-tab" src="../../images/vscode-getaavg-0AVMOT-slice-refactor-tab.png" /></p>
<p>This tab shows the code from the <em>WHEN</em> clause that you initially chose, the COBOL paragraph called from that <em>WHEN</em> clause (<em>3100-GET-AVG-MOT-PREMIUM</em>),  and then it shows COBOL code from paragraphs called from <em>3100-GET-AVG-MOT-PREMIUM</em>, and so on.  These various code snippets are presented to you in VS Code from information within the <em>refactor.cbls</em> file.  <em>refactor.cbls</em> is actually a JSON file, so while you're being shown COBOL source code, this file isn't in a format that can be compiled by the COBOL compiler.  The next step will take care of that.   You can close this <em>refactor.cbls</em> tab in order to reduce clutter in the VS Code window.</p>
</li>
<li>
<p>In the left side menu of VS Code under the <em>refactor</em> folder, find <em>refactor.cbls</em>. Right-click <em>refactor.cbls</em>, hover over the option for <em>Z Refactoring Assistant</em> and select <em>Generate Service Code</em>.</p>
<p><img alt="vscode-refactorcbl-generate" src="../../images/vscode-refactorcbl-generate.png" /></p>
</li>
<li>
<p>A new input field will appear in the top middle of VS Code prompting you to <em>Enter a service program name</em>. </p>
</li>
<li>
<p>In this field, type <code>GETMAVG</code> and press <em>Enter</em>. </p>
<p><img alt="vscode-getmavg" src="../../images/vscode-getmavg.png" /></p>
<p>A new tab will open with the refactored code, <em>GETMAVG.cbl</em>.</p>
<p><img alt="vscode-GETMAVG-2" src="../../images/vscode-GETMAVG-2.png" /></p>
<p>If it does not automatically open, double click <em>GETMAVG.cbl</em> from the left-side menu to open it.</p>
<p>What you have just done is you have created a COBOL source file, <em>GETMAVG.cbl</em>, with the refactored code, based on the contents of the <em>refactor.cbls</em> file.  <em>refactor.cbls</em> is actually a file in the JSON format which, while containing COBOL source code within it, also contains other control information in the JSON format.  When you <em>sliced</em> the code into a service, this control file <em>refactor.cbls</em> was created for you, and when you choose <em>Generate service code</em> against this control file, that is when the file containing COBOL source code, <em>GETMAVG.cbl</em>, was created.</p>
<p>Notice that we instructed you to use the name <em>GETMAVG</em> for the generated code.  This is because we are refactoring out the motor vehicle policy-related code from a larger program that dealt with multiple policy types.   The <em>M</em> in <em>GETMAVG</em> stands for motor vehicle.  Think of the first <em>A</em> in <em>GETAAVG</em> as standing for <em>all</em>.  </p>
</li>
</ol>
<h2 id="modify-the-refactored-service-code">Modify the refactored service code<a class="headerlink" href="#modify-the-refactored-service-code" title="Permanent link">&para;</a></h2>
<p>It is important to keep in mind that Refactoring Assistant is an <em>assistant</em> and that it may still be necessary to make some modifications to the refactored COBOL code.  These modifications might be necessary for several reasons, including</p>
<ul>
<li>
<p>To adhere to company coding standards</p>
</li>
<li>
<p>To fix problems that prevent the refactored COBOL code from compiling correctly</p>
</li>
<li>
<p>To remediate quirks in the refactored COBOL code that may be considered program defects and are likely to be fixed in future updates</p>
</li>
</ul>
<p>In this section we'll make several changes to the refactored code and give a rationale for why these changes are being made.</p>
<ol>
<li>
<p>In VS Code, make the following changes to the <code>GETMAVG.cbl</code> file:</p>
<ul>
<li>
<p>Comment out the following line as shown below by adding an asterisk in column 7 (it's a COBOL thing)</p>
<p><code>COPY SQLCA.</code></p>
<p><img alt="vscode-GETMAVG-edits-1" src="../../images/vscode-GETMAVG-edits-1.png" /></p>
</li>
</ul>
<p><strong>Q. Why did you make me do this?</strong> </p>
<p><strong>A.</strong> This appears to be a quirk in Refactoring Assistant.  The original source program did not have a <em>COPY SQLCA.</em> statement in it, but Refactoring Assistant added it.   This seems unnecessary because the lines right below that include SQLCA as part of the <em>EXEC SQL</em> statement perform the same purpose.</p>
<ul>
<li>
<p>Add the following 3 lines after <code>END-EXEC.</code> of <code>INCLUDE SQLCA</code></p>
<div class="highlight"><pre><span></span><code>EXEC SQL
  INCLUDE DGENAPP
END-EXEC.
</code></pre></div>
<p><img alt="vscode-GETMAVG-edits-2" src="../../images/vscode-GETMAVG-edits-2.png" /></p>
</li>
</ul>
<p><strong>Q. Why did you make me do this?</strong> </p>
<p><strong>A.</strong> This appears to be a quirk in Refactoring Assistant.  The original source program contained these lines, but Refactoring Assistant did not bring it along in its generated COBOL code. This include is necessary because it contains information about the SQL tables used that is necessary to be in the metadata information needed for Java transformation.  If you leave this line out then the data model classes will not be generated properly.</p>
<ul>
<li>
<p>Add a new line after statement <code>PROCEDURE DIVISION</code> and add <code>1000-MAIN-PARA.</code> on the newly inserted line.</p>
<p><img alt="vscode-GETMAVG-edits-3" src="../../images/vscode-GETMAVG-edits-3.png" /></p>
</li>
</ul>
<p><strong>Q. Why did you make me do this?</strong> </p>
<p><strong>A.</strong> This change may be considered a change to adhere to a corporate standard- perhaps the company's coding standard is that all paragraphs should be explicitly named, so the first paragraph in the <em>PROCEDURE DIVISION</em> is given an explict name.</p>
<ul>
<li>
<p>After <code>PERFORM 3100-GET-AVG-MOT-PREMIUM</code> add the following lines, making sure to place them in the same column as in the image below.</p>
<p><code>PERFORM 9000-END-PARA.</code></p>
<p><code>1000-EXIT.</code></p>
<p><img alt="vscode-GETMAVG-edits-4" src="../../images/vscode-GETMAVG-edits-4.png" /></p>
</li>
</ul>
<p><strong>Q. Why did you make me do this?</strong> </p>
<p><strong>A.</strong> The addition of <em>PERFORM 9000-END-PARA.</em> in this case is an example of a personal choice by the COBOL developer.   <em>9000-END-PARA</em> is a simple paragraph that displays a status code. This paragraph is called from other paragraphs in the new COBOL service, but maybe the COBOL developer chose to call the paragraph from this particular spot in the code.  The addition of <em>1000-EXIT.</em> may reflect a company coding convention- there are esoteric reasons why such an empty paragraph may be required by corporate coding standards. </p>
<ul>
<li>
<p>After <code>3100-GET-AVG-MOT-PREMIUM</code> add the following line.</p>
<p><code>MOVE 'Y' TO WS-CUSTOMER-EXISTS.</code></p>
<p><img alt="vscode-GETMAVG-edits-5" src="../../images/vscode-GETMAVG-edits-5.png" /></p>
</li>
</ul>
<p><strong>Q. Why did you make me do this?</strong> </p>
<p><strong>A.</strong> The developer may have preferred to initialize this variable prior to calling the subroutine.</p>
<ul>
<li>Comment out the <code>GOBACK.</code> statement at the end of the code.</li>
</ul>
<p><img alt="vscode-GETMAVG-edits-6" src="../../images/vscode-GETMAVG-edits-6.png" /></p>
<p><strong>Q. Why did you make me do this?</strong> </p>
<p><strong>A.</strong> Refactoring Assistant added an <em>EXIT PROGRAM</em> statement to the end of the generated service code, so the <em>GOBACK</em> statement is no longer necessary and can be removed.</p>
</li>
</ol>
<p>In the <em>Refactor</em> phase, </p>
<ol>
<li>We used knowledge about our sample application, GenApp, from the <em>Understand</em> phase to select the <em>GETAAVG</em> COBOL program.</li>
<li>We used IBM watsonx Code Assistant for Z Refactoring Assistant to refactor the <em>0AVMOT</em> conditional statement by slicing the conditional statement into service code.</li>
<li>We made some minor modifications to the COBOL service code that was generated to help make the point that the Refactoring Assistant is just that, an <em>assistant</em>, and that it is expected that the COBOL developer may have the need or desire to make modifications.</li>
<li>This service code will be used in the following <em>Transform</em> phase.</li>
</ol>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../understand/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Understand Phase">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Understand Phase
              </div>
            </div>
          </a>
        
        
          
          <a href="../transform/" class="md-footer__link md-footer__link--next" aria-label="Next: Transform Phase">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Transform Phase
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright © 2024 IBM Z Washington Systems Center
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["search.suggest", "search.highlight", "navigation.instant", "navigation.instant.progress", "navigation.footer"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.1e8ae164.min.js"></script>
      
        <script src="../../js/print-site.js"></script>
      
    
  </body>
</html>